{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="az-content-body">
    {% include "response.html" %}
    <div class="az-dashboard-one-title">
        <div>
            <h1>Hi, welcome back!</h1>
            <!-- <p class="az-dashboard-text">Your analytics dashboard.</p> -->
        </div>
    </div><!-- az-dashboard-one-title -->
    <div class="row mg-b-20">
        <div class="col-12" id="books_recommendation">
            <h2>Top 5 Recommendations</h2>
            <div class="row" id="recommended_books">

            </div>
        </div>
    </div>

    <div class="az-footer mg-t-auto">
        <div class="container">
            <span class="text-muted d-block text-center text-sm-left d-sm-inline-block">Copyright Â© LMS</span>
            <!-- <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center"><a href="https://juancoder.com"
                    target="_blank">Juancode IT Solutions</a></span> -->
        </div><!-- container -->
    </div><!-- az-footer -->

</div><!-- az-content-body -->
<style>
    .book-details {
        padding: 9px;
        font-size: 18px;
        font-weight: 600;
        display: flex;
        flex-direction: column;
    }

    .book-desc {
        font-size: 14px;
        font-weight: 400;
    }

    .book-ratings {
        font-size: 14px;
    }
</style>
<script type="text/javascript">
    loadRecommendations({{user.id}});
    function loadRecommendations(user_id){
        fetch("/books/recommendations", {
            method: "POST",
            body: JSON.stringify({ user_id: user_id })
        })
        .then(data => data.json())
        .then(json => {
            var books = "";
            for (var i = 0; i < json.data.length; i++) {
                const book_row = json.data[i];
                var cover = book_row.book_cover_img == "" ? "/static/assets/img/default_book_cover.jpg" :book_row.book_cover_img;

                books += '<div class="col-md-4 mt-2 d-flex"><img src="'+cover+'" style="border-radius: 3px;height: 250px; width: 166px; object-fit: cover;"><div><div class="book-details"><span>'+book_row.book_title+'</span><span class="book-desc">'+book_row.book_author+' ('+book_row.book_year_published+')</span><div class="book-ratings mt-3"><span class="badge badge-secondary" id="rateMe1" style="font-size: 12px; font-weight: 400;">'+book_row.book_category+'</span></div></div></div></div>';
            }
            $("#recommended_books").html(books);
        });
    }
</script>
{% endblock %}